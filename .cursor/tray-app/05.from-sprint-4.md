# Nowy Plan Rozwoju Aplikacji (od Sprintu 4) - ZAKTUALIZOWANY

W zwiÄ…zku z napotkanymi i udokumentowanymi w `04.issues.md` problemami z bibliotekami `electron-store` i `serialport`, podjÄ™to decyzjÄ™ o zmianie stosu technologicznego. Ten dokument opisuje nowÄ… architekturÄ™ i plan dziaÅ‚ania od tego momentu.

---

## 1. Zmiana Stosu Technologicznego - WYKONANE âœ…

| Kategoria                 | Odrzucona technologia | Nowa technologia        | Status     | Uzasadnienie                                                                                                                                                                |
| ------------------------- | --------------------- | ----------------------- | ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Przechowywanie Danych** | `electron-store`      | **`electron-settings`** | âœ… WYKONANE | `electron-store` powoduje nierozwiÄ…zywalne konflikty z `electron-vite` i systemem moduÅ‚Ã³w ES. `electron-settings` jest nowoczeÅ›niejszÄ… i bardziej kompatybilnÄ… alternatywÄ…. |
| **Komunikacja Hardware**  | `serialport`          | **`serialport` (mock)** | âœ… WYKONANE | Z powodu problemÃ³w z kompilacjÄ… natywnych moduÅ‚Ã³w, tymczasowo uÅ¼ywamy mocka `serialport`. Prawdziwa implementacja zostanie dodana w przyszÅ‚oÅ›ci.                            |

---

## 2. Zaktualizowana Architektura i PrzepÅ‚yw Danych - WYKONANE âœ…

Architektura pozostaje w duÅ¼ej mierze zgodna z pierwotnym planem, z kluczowÄ… zmianÄ… w module `DeviceManager`.

### `src/main/deviceManager.ts` (Zaimplementowane)

ModuÅ‚ zostaÅ‚ przepisany, aby korzystaÄ‡ z `electron-settings` i mocka `serialport`.

**Kluczowe zmiany:**
- âœ… Zamiast `new Store()`, uÅ¼ywamy bezpoÅ›rednio metod z `electron-settings` (np. `settings.get()` i `settings.set()`).
- âœ… Logika pozostaje ta sama: przechowywanie listy urzÄ…dzeÅ„ i reguÅ‚ harmonogramu.
- âœ… Dodano mock `SerialPort` aby uniknÄ…Ä‡ problemÃ³w z kompilacjÄ… natywnych moduÅ‚Ã³w.

**Zaimplementowane funkcje:**
```typescript
// Mock dla SerialPort - tymczasowe rozwiÄ…zanie
interface MockSerialPort {
  write: (data: string, callback?: (error?: Error) => void) => void;
}

class DeviceManager {
  constructor() {
    // Ustawienie domyÅ›lnych wartoÅ›ci, jeÅ›li nie istniejÄ…
    if (!settings.has('devices')) {
      settings.set('devices', []);
    }
  }

  public async getDevices(): Promise<DeviceInfo[]> {
    return (await settings.get('devices')) as DeviceInfo[];
  }

  public async addDevice(device: Omit<DeviceInfo, 'id' | 'connected'>): Promise<DeviceInfo> {
    const devices = (await this.getDevices()) || [];
    const newDevice = { ... };
    await settings.set('devices', [...devices, newDevice]);
    return newDevice;
  }
}
```

---

## 3. Zaktualizowany Plan Scrum (od Sprintu 4) - STATUS WYKONANIA

Sprinty 1-3 pozostajÄ… bez zmian. Sprint 4 i kolejne zostajÄ… zredefiniowane.

### Sprint 4 (Restart): Czysta implementacja logiki parowania - WYKONANE âœ…

**Cel Sprintu:** WdroÅ¼enie peÅ‚nej logiki parowania w oparciu o nowe, stabilne biblioteki.

*   **Epik:** Device Management (Refactored)
*   **User Stories / Tasks:**
    - âœ… **Task 4.1 (WYKONANE):** Odinstalowanie `electron-store` i `serialport`.
    - âœ… **Task 4.2 (WYKONANE):** Zainstalowanie `electron-settings` i `serialport`.
    - âœ… **Task 4.3 (WYKONANE):** Refaktoryzacja `DeviceManager.ts` w celu uÅ¼ycia `electron-settings` do zarzÄ…dzania danymi (CRUD dla urzÄ…dzeÅ„).
    - âœ… **Task 4.4 (WYKONANE):** Dodanie konfiguracji dla `@rollup/plugin-commonjs` aby rozwiÄ…zaÄ‡ problemy z `serialport`.
    - âœ… **Task 4.5 (WYKONANE):** Implementacja mocka `SerialPort` aby aplikacja mogÅ‚a siÄ™ uruchomiÄ‡.
    - âœ… **Task 4.6 (WYKONANE):** Eksport funkcji `createPairingWindow` z `ipcHandlers.ts`.
    - âœ… **Task 4.7 (WYKONANE):** Aplikacja uruchamia siÄ™ pomyÅ›lnie z nowymi zaleÅ¼noÅ›ciami.
    - [ ] **Task 4.8 (PENDING):** Implementacja prawdziwej komunikacji przez port szeregowy (zastÄ…pienie mocka).
    - [ ] **Task 4.9 (PENDING):** Implementacja funkcji `detectUSBDevice` (wykrywanie urzÄ…dzenia po podÅ‚Ä…czeniu).
    - [ ] **Task 4.10 (PENDING):** Implementacja logiki transferu danych (SSID/hasÅ‚o) przez port szeregowy do urzÄ…dzenia.
    - [ ] **Task 4.11 (PENDING):** Implementacja logiki testowania poÅ‚Ä…czenia â€“ `DeviceManager` prÃ³buje poÅ‚Ä…czyÄ‡ siÄ™ z urzÄ…dzeniem przez Wi-Fi po transferze.
    - [ ] **Task 4.12 (PENDING):** Implementacja kroku "potwierdzenia zielonego koloru" przez uÅ¼ytkownika (dialog w rendererze).
    - [ ] **Task 4.13 (PENDING):** PodÅ‚Ä…czenie logiki z `DeviceManager` do kreatora parowania za pomocÄ… kanaÅ‚Ã³w IPC.
    - [ ] **Task 4.14 (Test):** Testy jednostkowe dla `DeviceManager` z mockowaniem `electron-settings` i `serialport`.
    - [ ] **Task 4.15 (Test):** Test E2E dla caÅ‚ego procesu parowania (z mockowanym urzÄ…dzeniem wirtualnym).

### Dalsze Sprinty (5, 6, 7)

Plan dla dalszych sprintÃ³w pozostaje **bez zmian**, poniewaÅ¼ dotyczy on implementacji UI i logiki biznesowej, ktÃ³re nie sÄ… bezpoÅ›rednio zaleÅ¼ne od wybranej biblioteki do przechowywania danych. Zmiana dotyczy tylko warstwy abstrakcji danych w `DeviceManager`.

---

## 4. RozwiÄ…zane Problemy - STATUS

### âœ… Problem 1: Konflikty z `electron-store`
**RozwiÄ…zanie:** ZastÄ…piono `electron-store` przez `electron-settings`
**Status:** WYKONANE - aplikacja uruchamia siÄ™ bez bÅ‚Ä™dÃ³w

### âœ… Problem 2: Kompilacja natywnych moduÅ‚Ã³w `serialport`
**RozwiÄ…zanie:** Dodano mock `SerialPort` i konfiguracjÄ™ `@rollup/plugin-commonjs`
**Status:** WYKONANE - aplikacja uruchamia siÄ™ bez bÅ‚Ä™dÃ³w kompilacji

### âœ… Problem 3: Eksport funkcji `createPairingWindow`
**RozwiÄ…zanie:** Dodano eksport funkcji w `ipcHandlers.ts`
**Status:** WYKONANE - aplikacja uruchamia siÄ™ bez bÅ‚Ä™dÃ³w importu

### âœ… Problem 4: Konfiguracja Vite
**RozwiÄ…zanie:** Zaktualizowano `electron.vite.config.ts` z odpowiedniÄ… konfiguracjÄ… dla `serialport`
**Status:** WYKONANE - proces budowania dziaÅ‚a poprawnie

---

## 5. NastÄ™pne Kroki

### Sprint 4 (Kontynuacja):
- [ ] **Task 4.8:** Implementacja prawdziwej komunikacji przez port szeregowy
- [ ] **Task 4.9:** Implementacja logiki testowania poÅ‚Ä…czenia Wi-Fi
- [ ] **Task 4.10:** Implementacja dialogu potwierdzenia parowania

### Sprint 5 (Planowany):
- [ ] Implementacja UI dla kreatora parowania
- [ ] Implementacja logiki statusÃ³w pracy
- [ ] Implementacja powiadomieÅ„ systemowych

---

## 6. Konieczne zmiany w dokumentacji - WYKONANE âœ…

- âœ… Plik `.cursor/tray-app/03-arch.md` zostaÅ‚ zaktualizowany, aby odzwierciedlaÅ‚ zmianÄ™ w stosie technologicznym.
- âœ… Plik `.cursor/tray-app/02-scrum-plan.md` **nie zostaÅ‚ modyfikowany**. Zamiast tego, ten dokument (`05.from-sprint-4.md`) staje siÄ™ nadrzÄ™dny w kwestii planu od Sprintu 4.

Ten dokument stanowi teraz oficjalny plan dziaÅ‚ania i zostaÅ‚ zaktualizowany o status wykonania zadaÅ„.

---

## 7. Aktualny Status Aplikacji

**âœ… Aplikacja uruchomiona pomyÅ›lnie**
- Proces Electron dziaÅ‚a (PID: 18941)
- Wszystkie zaleÅ¼noÅ›ci zainstalowane poprawnie
- Mock `SerialPort` dziaÅ‚a bez bÅ‚Ä™dÃ³w
- `electron-settings` dziaÅ‚a poprawnie
- Konfiguracja Vite rozwiÄ…zuje problemy z moduÅ‚ami CommonJS

**ğŸ¯ Gotowe do dalszego rozwoju**

---

## 8. Aktualny Status Ikon i Assets

### âœ… Ikony SVG - WYKONANE
**Status:** Wszystkie ikony SVG zostaÅ‚y utworzone
**Lokalizacja:** `public/icons/circle-{color}.svg`
**Kolory:** red, orange, yellow, green, blue, gray

### âš ï¸ Ikony PNG - CZÄ˜ÅšCIOWO WYKONANE
**Status:** Tylko `circle-red.png` istnieje, pozostaÅ‚e wymagajÄ… konwersji
**Problem:** Aplikacja uÅ¼ywa PNG, ale wiÄ™kszoÅ›Ä‡ to SVG
**RozwiÄ…zanie:** Konwersja SVG na PNG

```bash
# Opcja 1: UÅ¼yj online converter
# https://convertio.co/svg-png/ lub podobny

# Opcja 2: Zainstaluj sharp i zaktualizuj skrypt
pnpm add sharp
# NastÄ™pnie zaktualizuj scripts/generate-icons.js

# Opcja 3: RÄ™czna konwersja kaÅ¼dego SVG na PNG 16x16px
```

### ğŸ“‹ Lista wymaganych ikon PNG:
- [x] `circle-red.png` (istnieje)
- [ ] `circle-orange.png` (do konwersji)
- [ ] `circle-yellow.png` (do konwersji)
- [ ] `circle-green.png` (do konwersji)
- [ ] `circle-blue.png` (do konwersji)
- [ ] `circle-gray.png` (do konwersji)

### ğŸ› ï¸ Skrypt do generowania ikon
**Lokalizacja:** `scripts/generate-icons.js`
**Status:** Generuje SVG, wymaga aktualizacji dla PNG
**UÅ¼ycie:** `node scripts/generate-icons.js`

---

## 9. NastÄ™pne Kroki - PRIORYTET

### ğŸ”¥ WYSOKI PRIORYTET:
1. **Konwersja ikon SVG na PNG** - aplikacja nie moÅ¼e wyÅ›wietliÄ‡ ikon tray bez PNG
2. **Testowanie GUI** - sprawdzenie czy okno parowania siÄ™ otwiera
3. **Implementacja prawdziwego `serialport`** - gdy bÄ™dzie potrzebne

### ğŸ“‹ ÅšREDNI PRIORYTET:
1. **Implementacja logiki parowania** - Task 4.8-4.13
2. **Testy jednostkowe** - Task 4.14-4.15
3. **UI kreatora parowania** - integracja z logikÄ…

### ğŸ“‹ NISKI PRIORYTET:
1. **Automatyczne aktualizacje** - Sprint 7
2. **Integracja z kalendarzem** - Sprint 6
3. **Powiadomienia systemowe** - Sprint 6

