# Device Mock - Project Overview

## 🎯 Cel Projektu

Stworzenie mocka urządzenia LED dla aplikacji WFH Indicator, który będzie symulował zachowanie prawdziwego urządzenia ESP32 + WS2812B LED ring. Mock będzie używany do testowania komunikacji między tray app a urządzeniem bez potrzeby posiadania prawdziwego hardware.

## 🏗️ Architektura Mocka

### Struktura Projektu
```
emulator/
├── src/
│   ├── main/
│   │   ├── deviceMock.ts      # Główna logika mocka
│   │   ├── ledController.ts    # Symulacja LED ring
│   │   ├── buttonHandler.ts    # Symulacja przycisku fizycznego
│   │   └── wifiManager.ts      # Symulacja WiFi komunikacji
│   ├── types/
│   │   └── deviceTypes.ts      # Typy TypeScript
│   └── utils/
│       ├── colorUtils.ts       # Konwersje kolorów
│       └── serialUtils.ts      # Symulacja komunikacji szeregowej
├── tests/
│   ├── unit/
│   └── integration/
├── package.json
├── tsconfig.json
└── README.md
```

## 📋 Wymagania Funkcjonalne

### 1. Symulacja LED Ring
- **Status Colors**: Red, Orange, Yellow, Green, Blue, Gray
- **Animation**: Smooth transitions between colors
- **Brightness**: Simulated brightness levels (0-100%)
- **Patterns**: Breathing effect, pulse, solid

### 2. Symulacja Przycisku Fizycznego
- **Ask to Enter**: Single press triggers "Ask to Enter" request
- **Long Press**: Reset device/enter pairing mode
- **Double Press**: Toggle brightness
- **Visual Feedback**: LED blinks when button pressed

### 3. Komunikacja WiFi
- **WebSocket Server**: Listens for status updates from tray app
- **Status Sync**: Receives and displays current work status
- **Ask to Enter**: Sends requests to tray app
- **Battery Level**: Reports simulated battery level every 5 minutes

### 4. Komunikacja Serial (Pairing)
- **SSID/Password**: Receives WiFi credentials during pairing
- **Connection Test**: Simulates connection test
- **Pairing Confirmation**: Green LED confirmation

## 🔧 Stack Technologiczny

- **Language**: TypeScript
- **Package Manager**: pnpm
- **Testing**: Jest + @types/jest
- **Documentation**: JSDoc
- **Linting**: ESLint + Prettier

## 📊 Success Metrics

### Technical Metrics
- **Test Coverage**: >90% for core functionality
- **Performance**: <100ms response time for status updates
- **Reliability**: 99.9% uptime during testing sessions
- **Compatibility**: Works with current tray app without modifications

### Development Metrics
- **Code Quality**: ESLint score >95%
- **Documentation**: JSDoc coverage for all public APIs
- **Maintainability**: Clear separation of concerns, modular design

## 🚀 Quick Start

### Instalacja
```bash
cd emulator
pnpm install
```

### Uruchomienie
```bash
# Development mode
pnpm dev

# Test mode
pnpm test:mock

# Production build
pnpm build
```

### Testy
```bash
# Unit tests
pnpm test

# Integration tests
pnpm test:integration

# E2E tests with tray app
pnpm test:e2e
```

## 🔨 Jak Zbudować Emulator

### Krok 1: Przygotowanie Środowiska
```bash
# Sprawdź czy masz Node.js 18+
node --version

# Sprawdź czy masz pnpm
pnpm --version

# Jeśli nie masz pnpm, zainstaluj go
npm install -g pnpm
```

### Krok 2: Inicjalizacja Projektu
```bash
# Przejdź do folderu emulator
cd emulator

# Zainstaluj zależności
pnpm install

# Sprawdź czy wszystko działa
pnpm build
```

### Krok 3: Konfiguracja
```bash
# Skopiuj plik konfiguracyjny
cp .env.example .env.local

# Edytuj konfigurację
nano .env.local
```

Przykładowa konfiguracja `.env.local`:
```bash
# Port dla WebSocket server
MOCK_PORT=8080

# Port szeregowy (symulacja)
MOCK_SERIAL_PORT=/dev/ttyUSB0

# Tryb testowy
MOCK_TEST_MODE=false

# Debug mode
MOCK_DEBUG=true

# Poziom baterii (0-100)
MOCK_BATTERY_LEVEL=100

# Stan ładowania
MOCK_CHARGING=false
```

### Krok 4: Budowanie i Uruchomienie
```bash
# Budowanie projektu
pnpm build

# Uruchomienie w trybie development
pnpm dev

# Uruchomienie w trybie testowym
pnpm test:mock

# Uruchomienie w trybie production
pnpm start
```

### Krok 5: Weryfikacja
```bash
# Sprawdź czy emulator działa
curl http://localhost:8080/health

# Sprawdź logi
tail -f logs/combined.log

# Sprawdź status LED
curl http://localhost:8080/api/led/status
```

## 🧪 Testowanie Emulatora

### Testy Jednostkowe
```bash
# Uruchom wszystkie testy jednostkowe
pnpm test

# Uruchom testy z pokryciem
pnpm test:coverage

# Uruchom konkretny test
pnpm test -- tests/unit/ledController.test.ts
```

### Testy Integracyjne
```bash
# Uruchom testy integracyjne
pnpm test:integration

# Uruchom testy z debug mode
MOCK_DEBUG=true pnpm test:integration
```

### Testy E2E z Tray App
```bash
# Terminal 1: Uruchom emulator
cd emulator
pnpm start:mock

# Terminal 2: Uruchom testy E2E
cd ../tray-app
pnpm test:e2e
```

## 🔧 Debugowanie

### Włączanie Debug Mode
```bash
# Uruchom z debug mode
MOCK_DEBUG=true pnpm dev

# Lub w kodzie
const mock = new DeviceMock({
  debug: true,
  testMode: true
});
```

### Sprawdzanie Logów
```bash
# Logi aplikacji
tail -f logs/combined.log

# Logi błędów
tail -f logs/error.log

# Logi w czasie rzeczywistym
pnpm dev -- --verbose
```

### Sprawdzanie Statusu
```bash
# Status emulatora
curl http://localhost:8080/api/status

# Status LED
curl http://localhost:8080/api/led/status

# Status WiFi
curl http://localhost:8080/api/wifi/status

# Status baterii
curl http://localhost:8080/api/battery/status
```

## 🚨 Rozwiązywanie Problemów

### Port Zajęty
```bash
# Sprawdź czy port 8080 jest zajęty
lsof -i :8080

# Zabij proces używający port
kill -9 <PID>

# Lub zmień port w konfiguracji
MOCK_PORT=8081 pnpm dev
```

### Błędy Kompilacji
```bash
# Wyczyść cache
pnpm clean

# Zainstaluj zależności ponownie
pnpm install

# Sprawdź TypeScript
pnpm type-check
```

### Błędy Testów
```bash
# Uruchom testy z verbose
pnpm test -- --verbose

# Sprawdź konkretny test
pnpm test -- --testNamePattern="LED Controller"

# Uruchom testy w trybie watch
pnpm test:watch
```

## 📦 Deployment

### Docker
```bash
# Budowanie obrazu Docker
docker build -t wfh-emulator .

# Uruchomienie kontenera
docker run -p 8080:8080 wfh-emulator

# Uruchomienie z docker-compose
docker-compose up -d
```

### Production Build
```bash
# Budowanie dla production
pnpm build:prod

# Uruchomienie w production
NODE_ENV=production pnpm start
```

---

**Note**: Szczegółowe informacje o implementacji znajdziesz w pozostałych dokumentach:
- `02.architecture.md` - Szczegółowa architektura
- `03.api.md` - API dokumentacja
- `04.testing.md` - Strategia testowania
- `05.integration.md` - Integracja z tray app
- `06.deployment.md` - Deployment i CI/CD
