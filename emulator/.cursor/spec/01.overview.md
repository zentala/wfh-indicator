# Device Mock - Project Overview

## ðŸŽ¯ Cel Projektu

Stworzenie mocka urzÄ…dzenia LED dla aplikacji WFH Indicator, ktÃ³ry bÄ™dzie symulowaÅ‚ zachowanie prawdziwego urzÄ…dzenia ESP32 + WS2812B LED ring. Mock bÄ™dzie uÅ¼ywany do testowania komunikacji miÄ™dzy tray app a urzÄ…dzeniem bez potrzeby posiadania prawdziwego hardware.

## ðŸ—ï¸ Architektura Mocka

### Struktura Projektu
```
emulator/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ deviceMock.ts      # GÅ‚Ã³wna logika mocka
â”‚   â”‚   â”œâ”€â”€ ledController.ts    # Symulacja LED ring
â”‚   â”‚   â”œâ”€â”€ buttonHandler.ts    # Symulacja przycisku fizycznego
â”‚   â”‚   â””â”€â”€ wifiManager.ts      # Symulacja WiFi komunikacji
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ deviceTypes.ts      # Typy TypeScript
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ colorUtils.ts       # Konwersje kolorÃ³w
â”‚       â””â”€â”€ serialUtils.ts      # Symulacja komunikacji szeregowej
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## ðŸ“‹ Wymagania Funkcjonalne

### 1. Symulacja LED Ring
- **Status Colors**: Red, Orange, Yellow, Green, Blue, Gray
- **Animation**: Smooth transitions between colors
- **Brightness**: Simulated brightness levels (0-100%)
- **Patterns**: Breathing effect, pulse, solid

### 2. Symulacja Przycisku Fizycznego
- **Ask to Enter**: Single press triggers "Ask to Enter" request
- **Long Press**: Reset device/enter pairing mode
- **Double Press**: Toggle brightness
- **Visual Feedback**: LED blinks when button pressed

### 3. Komunikacja WiFi
- **WebSocket Server**: Listens for status updates from tray app
- **Status Sync**: Receives and displays current work status
- **Ask to Enter**: Sends requests to tray app
- **Battery Level**: Reports simulated battery level every 5 minutes

### 4. Komunikacja Serial (Pairing)
- **SSID/Password**: Receives WiFi credentials during pairing
- **Connection Test**: Simulates connection test
- **Pairing Confirmation**: Green LED confirmation

## ðŸ”§ Stack Technologiczny

- **Language**: TypeScript
- **Package Manager**: pnpm
- **Testing**: Jest + @types/jest
- **Documentation**: JSDoc
- **Linting**: ESLint + Prettier

## ðŸ“Š Success Metrics

### Technical Metrics
- **Test Coverage**: >90% for core functionality
- **Performance**: <100ms response time for status updates
- **Reliability**: 99.9% uptime during testing sessions
- **Compatibility**: Works with current tray app without modifications

### Development Metrics
- **Code Quality**: ESLint score >95%
- **Documentation**: JSDoc coverage for all public APIs
- **Maintainability**: Clear separation of concerns, modular design

## ðŸš€ Quick Start

### Instalacja
```bash
cd emulator
pnpm install
```

### Uruchomienie
```bash
# Development mode
pnpm dev

# Test mode
pnpm test:mock

# Production build
pnpm build
```

### Testy
```bash
# Unit tests
pnpm test

# Integration tests
pnpm test:integration

# E2E tests with tray app
pnpm test:e2e
```

## ðŸ”¨ Jak ZbudowaÄ‡ Emulator

### Krok 1: Przygotowanie Åšrodowiska
```bash
# SprawdÅº czy masz Node.js 18+
node --version

# SprawdÅº czy masz pnpm
pnpm --version

# JeÅ›li nie masz pnpm, zainstaluj go
npm install -g pnpm
```

### Krok 2: Inicjalizacja Projektu
```bash
# PrzejdÅº do folderu emulator
cd emulator

# Zainstaluj zaleÅ¼noÅ›ci
pnpm install

# SprawdÅº czy wszystko dziaÅ‚a
pnpm build
```

### Krok 3: Konfiguracja
```bash
# Skopiuj plik konfiguracyjny
cp .env.example .env.local

# Edytuj konfiguracjÄ™
nano .env.local
```

PrzykÅ‚adowa konfiguracja `.env.local`:
```bash
# Port dla WebSocket server
MOCK_PORT=8080

# Port szeregowy (symulacja)
MOCK_SERIAL_PORT=/dev/ttyUSB0

# Tryb testowy
MOCK_TEST_MODE=false

# Debug mode
MOCK_DEBUG=true

# Poziom baterii (0-100)
MOCK_BATTERY_LEVEL=100

# Stan Å‚adowania
MOCK_CHARGING=false
```

### Krok 4: Budowanie i Uruchomienie
```bash
# Budowanie projektu
pnpm build

# Uruchomienie w trybie development
pnpm dev

# Uruchomienie w trybie testowym
pnpm test:mock

# Uruchomienie w trybie production
pnpm start
```

### Krok 5: Weryfikacja
```bash
# SprawdÅº czy emulator dziaÅ‚a
curl http://localhost:8080/health

# SprawdÅº logi
tail -f logs/combined.log

# SprawdÅº status LED
curl http://localhost:8080/api/led/status
```

## ðŸ§ª Testowanie Emulatora

### Testy Jednostkowe
```bash
# Uruchom wszystkie testy jednostkowe
pnpm test

# Uruchom testy z pokryciem
pnpm test:coverage

# Uruchom konkretny test
pnpm test -- tests/unit/ledController.test.ts
```

### Testy Integracyjne
```bash
# Uruchom testy integracyjne
pnpm test:integration

# Uruchom testy z debug mode
MOCK_DEBUG=true pnpm test:integration
```

### Testy E2E z Tray App
```bash
# Terminal 1: Uruchom emulator
cd emulator
pnpm start:mock

# Terminal 2: Uruchom testy E2E
cd ../tray-app
pnpm test:e2e
```

## ðŸ”§ Debugowanie

### WÅ‚Ä…czanie Debug Mode
```bash
# Uruchom z debug mode
MOCK_DEBUG=true pnpm dev

# Lub w kodzie
const mock = new DeviceMock({
  debug: true,
  testMode: true
});
```

### Sprawdzanie LogÃ³w
```bash
# Logi aplikacji
tail -f logs/combined.log

# Logi bÅ‚Ä™dÃ³w
tail -f logs/error.log

# Logi w czasie rzeczywistym
pnpm dev -- --verbose
```

### Sprawdzanie Statusu
```bash
# Status emulatora
curl http://localhost:8080/api/status

# Status LED
curl http://localhost:8080/api/led/status

# Status WiFi
curl http://localhost:8080/api/wifi/status

# Status baterii
curl http://localhost:8080/api/battery/status
```

## ðŸš¨ RozwiÄ…zywanie ProblemÃ³w

### Port ZajÄ™ty
```bash
# SprawdÅº czy port 8080 jest zajÄ™ty
lsof -i :8080

# Zabij proces uÅ¼ywajÄ…cy port
kill -9 <PID>

# Lub zmieÅ„ port w konfiguracji
MOCK_PORT=8081 pnpm dev
```

### BÅ‚Ä™dy Kompilacji
```bash
# WyczyÅ›Ä‡ cache
pnpm clean

# Zainstaluj zaleÅ¼noÅ›ci ponownie
pnpm install

# SprawdÅº TypeScript
pnpm type-check
```

### BÅ‚Ä™dy TestÃ³w
```bash
# Uruchom testy z verbose
pnpm test -- --verbose

# SprawdÅº konkretny test
pnpm test -- --testNamePattern="LED Controller"

# Uruchom testy w trybie watch
pnpm test:watch
```

## ðŸ“¦ Deployment

### Docker
```bash
# Budowanie obrazu Docker
docker build -t wfh-emulator .

# Uruchomienie kontenera
docker run -p 8080:8080 wfh-emulator

# Uruchomienie z docker-compose
docker-compose up -d
```

### Production Build
```bash
# Budowanie dla production
pnpm build:prod

# Uruchomienie w production
NODE_ENV=production pnpm start
```

---

**Note**: SzczegÃ³Å‚owe informacje o implementacji znajdziesz w pozostaÅ‚ych dokumentach:
- `02.architecture.md` - SzczegÃ³Å‚owa architektura
- `03.api.md` - API dokumentacja
- `04.testing.md` - Strategia testowania
- `05.integration.md` - Integracja z tray app
- `06.deployment.md` - Deployment i CI/CD
