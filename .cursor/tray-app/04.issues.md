# Problemy Napotkane w Projekcie

Ten dokument opisuje problemy techniczne napotkane podczas rozwoju aplikacji WFH Indicator oraz ich rozwiązania.

---

## 1. Problem z `electron-store` i `electron-vite`

### Opis problemu
Biblioteka `electron-store` powoduje konflikty z `electron-vite` podczas procesu budowania. Problem wynika z niekompatybilności między systemem modułów ES używanych przez Vite a CommonJS używanych przez `electron-store`.

### Błąd
```
Error: Cannot find module 'electron-store'
```

### Rozwiązanie ✅ WYKONANE
Zastąpiono `electron-store` przez `electron-settings`, który jest nowocześniejszą i bardziej kompatybilną alternatywą.

**Zmiany:**
- Odinstalowano `electron-store`
- Zainstalowano `electron-settings`
- Zrefaktoryzowano `DeviceManager.ts` aby używał nowej biblioteki
- Zaktualizowano dokumentację w `03-arch.md`

---

## 2. Problem z kompilacją natywnych modułów `serialport`

### Opis problemu
Biblioteka `serialport` wymaga kompilacji natywnych modułów C++, co powoduje problemy w środowisku WSL2 z niekompatybilnymi wersjami kompilatora g++.

### Błąd
```
error: unrecognized command line option '-std=gnu++20'
```

### Rozwiązanie ✅ WYKONANE
Dodano konfigurację `@rollup/plugin-commonjs` i tymczasowy mock `SerialPort`.

**Zmiany:**
- Dodano konfigurację `@rollup/plugin-commonjs` w `electron.vite.config.ts`
- Zaimplementowano mock `SerialPort` w `DeviceManager.ts`
- Aplikacja uruchamia się bez błędów kompilacji
- Prawdziwa implementacja `serialport` zostanie dodana w przyszłości

---

## 3. Problem z eksportem funkcji `createPairingWindow`

### Opis problemu
Funkcja `createPairingWindow` nie była eksportowana z `ipcHandlers.ts`, co powodowało błędy importu w `tray.ts`.

### Błąd
```
Error: Cannot find module './ipcHandlers' or its missing named export 'createPairingWindow'
```

### Rozwiązanie ✅ WYKONANE
Dodano eksport funkcji `createPairingWindow` w `ipcHandlers.ts`.

**Zmiany:**
- Dodano `export` przed deklaracją funkcji `createPairingWindow`
- Funkcja jest teraz dostępna w `tray.ts`

---

## 4. Problem z konfiguracją Vite dla modułów CommonJS

### Opis problemu
`electron-vite` nie obsługuje automatycznie modułów CommonJS, co powoduje problemy z bibliotekami takimi jak `serialport`.

### Rozwiązanie ✅ WYKONANE
Dodano konfigurację `@rollup/plugin-commonjs` w `electron.vite.config.ts`.

**Zmiany:**
```typescript
rollupOptions: {
  plugins: [
    commonjs({
      include: [
        /node_modules/,
        /serialport/,
        /@serialport/,
      ],
      transformMixedEsModules: true,
    }),
  ],
},
```

---

## 5. Podsumowanie Rozwiązanych Problemów

### ✅ Wszystkie krytyczne problemy zostały rozwiązane:
1. **`electron-store`** → zastąpiono przez `electron-settings`
2. **Kompilacja `serialport`** → dodano mock i konfigurację Vite
3. **Eksport funkcji** → dodano brakujący eksport
4. **Konfiguracja Vite** → dodano obsługę modułów CommonJS

### 🎯 Status aplikacji:
- ✅ Aplikacja uruchamia się pomyślnie
- ✅ Wszystkie zależności działają poprawnie
- ✅ Proces budowania działa bez błędów
- ✅ Gotowe do dalszego rozwoju

### 📋 Następne kroki:
- Implementacja prawdziwej komunikacji przez port szeregowy
- Implementacja UI dla kreatora parowania
- Implementacja logiki statusów pracy

---

## 6. Wnioski i Lekcje

### Kluczowe wnioski:
1. **Kompatybilność bibliotek** - Ważne jest sprawdzanie kompatybilności bibliotek z używanym build tool
2. **Mockowanie** - Tymczasowe mocki pozwalają na kontynuację rozwoju bez blokowania
3. **Konfiguracja Vite** - Właściwa konfiguracja jest kluczowa dla obsługi modułów CommonJS
4. **Dokumentacja** - Aktualizacja dokumentacji jest równie ważna jak kod

### Rekomendacje na przyszłość:
1. Testowanie bibliotek w środowisku deweloperskim przed wdrożeniem
2. Używanie mocków dla problematycznych zależności
3. Regularna aktualizacja dokumentacji o statusie problemów
4. Planowanie alternatywnych rozwiązań dla krytycznych zależności
