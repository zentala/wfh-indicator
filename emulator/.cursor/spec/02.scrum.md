# Device Mock - Scrum Plan Implementation

## üéØ Cel Projektu

Implementacja mocka urzƒÖdzenia LED dla aplikacji WFH Indicator, kt√≥ry bƒôdzie symulowa≈Ç zachowanie prawdziwego urzƒÖdzenia ESP32 + WS2812B LED ring. Mock bƒôdzie u≈ºywany do testowania komunikacji miƒôdzy tray app a urzƒÖdzeniem bez potrzeby posiadania prawdziwego hardware.

## üìã Sprint Overview

| Sprint   | Cel                                             | Czas trwania | Status    |
| -------- | ----------------------------------------------- | ------------ | --------- |
| Sprint 1 | Budowanie emulatora - podstawowa infrastruktura | 1 tydzie≈Ñ    | Planowany |
| Sprint 2 | Budowanie emulatora - LED simulation            | 1 tydzie≈Ñ    | Planowany |
| Sprint 3 | Budowanie emulatora - WiFi communication        | 1 tydzie≈Ñ    | Planowany |
| Sprint 4 | Integracja z tray app                           | 1 tydzie≈Ñ    | Planowany |
| Sprint 5 | Zaawansowane funkcje i optymalizacja            | 1 tydzie≈Ñ    | Planowany |

---

## Sprint 1: Budowanie Emulatora - Podstawowa Infrastruktura

**Cel Sprintu:** Stworzenie podstawowej infrastruktury projektu emulatora.

### Epik: Project Setup & Core Infrastructure

#### **Task 1.1: Inicjalizacja projektu emulatora** üî• WYSOKI PRIORYTET
**Cel:** Stworzenie podstawowej struktury projektu emulatora

**Szczeg√≥≈Çy implementacji:**
- [ ] Utworzenie struktury folder√≥w emulatora
- [ ] Konfiguracja TypeScript dla emulatora
- [ ] Konfiguracja pnpm dla emulatora
- [ ] Konfiguracja ESLint + Prettier dla emulatora
- [ ] Konfiguracja Jest dla emulatora
- [ ] Utworzenie package.json z zale≈ºno≈õciami dla emulatora

**Kryteria uko≈Ñczenia:**
- [ ] Projekt emulatora siƒô buduje bez b≈Çƒôd√≥w
- [ ] ESLint przechodzi bez b≈Çƒôd√≥w
- [ ] Jest uruchamia siƒô poprawnie
- [ ] TypeScript compilation dzia≈Ça

#### **Task 1.2: Implementacja Device Types** üî• WYSOKI PRIORYTET
**Cel:** Definicje typ√≥w TypeScript dla emulatora

**Szczeg√≥≈Çy implementacji:**
- [ ] Utworzenie `src/types/deviceTypes.ts`
- [ ] WorkStatus enum
- [ ] LEDPattern interface
- [ ] WiFiCredentials interface
- [ ] DeviceInfo interface
- [ ] Message interfaces (WebSocket)

**Kryteria uko≈Ñczenia:**
- [ ] Wszystkie typy sƒÖ zdefiniowane
- [ ] TypeScript compilation bez b≈Çƒôd√≥w
- [ ] JSDoc dla wszystkich typ√≥w

#### **Task 1.3: Implementacja Color Utils** üìã ≈öREDNI PRIORYTET
**Cel:** Narzƒôdzia do konwersji kolor√≥w dla emulatora

**Szczeg√≥≈Çy implementacji:**
- [ ] Utworzenie `src/utils/colorUtils.ts`
- [ ] Funkcje konwersji RGB ‚Üî HEX
- [ ] Funkcje konwersji status ‚Üí color
- [ ] Funkcje brightness adjustment
- [ ] Funkcje color validation

**Kryteria uko≈Ñczenia:**
- [ ] Wszystkie funkcje konwersji dzia≈ÇajƒÖ
- [ ] Testy jednostkowe dla color utils
- [ ] Obs≈Çuga b≈Çƒôd√≥w dla nieprawid≈Çowych kolor√≥w

#### **Task 1.4: Implementacja Serial Utils** üìã ≈öREDNI PRIORYTET
**Cel:** Symulacja komunikacji szeregowej dla emulatora

**Szczeg√≥≈Çy implementacji:**
- [ ] Utworzenie `src/utils/serialUtils.ts`
- [ ] Symulacja SerialPort
- [ ] Funkcje read/write
- [ ] Data encoding/decoding
- [ ] Error simulation

**Kryteria uko≈Ñczenia:**
- [ ] Serial communication dzia≈Ça
- [ ] Data encoding/decoding dzia≈Ça
- [ ] Error simulation dzia≈Ça
- [ ] Testy jednostkowe dla serial utils

#### **Task 1.5: Testy jednostkowe dla podstawowej infrastruktury** üìã ≈öREDNI PRIORYTET
**Cel:** Pokrycie testami podstawowej infrastruktury emulatora

**Szczeg√≥≈Çy implementacji:**
- [ ] Testy dla Device Types
- [ ] Testy dla Color Utils
- [ ] Testy dla Serial Utils
- [ ] Mocki dla zale≈ºno≈õci

**Kryteria uko≈Ñczenia:**
- [ ] Pokrycie testami >80%
- [ ] Wszystkie testy przechodzƒÖ
- [ ] Testy dla edge cases

---

## Sprint 2: Budowanie Emulatora - LED Simulation

**Cel Sprintu:** Implementacja symulacji LED ring w emulatorze.

### Epik: LED Controller & Animation

#### **Task 2.1: Implementacja LED Controller** üî• WYSOKI PRIORYTET
**Cel:** Symulacja LED ring z kolorami status√≥w

**Szczeg√≥≈Çy implementacji:**
- [ ] Utworzenie `src/main/ledController.ts`
- [ ] Implementacja enum WorkStatus
- [ ] Implementacja LEDPattern interface
- [ ] Funkcje setColor(), setBrightness(), setPattern()
- [ ] Symulacja animacji (breathing, pulse, blink)
- [ ] Console output dla wizualizacji LED

**Kryteria uko≈Ñczenia:**
- [ ] LED Controller obs≈Çuguje wszystkie kolory status√≥w
- [ ] Animacje dzia≈ÇajƒÖ poprawnie
- [ ] Console output pokazuje stan LED
- [ ] Testy jednostkowe dla LED Controller

#### **Task 2.2: Implementacja LED Patterns** üî• WYSOKI PRIORYTET
**Cel:** Zaawansowane wzory animacji LED

**Szczeg√≥≈Çy implementacji:**
- [ ] Breathing pattern implementation
- [ ] Pulse pattern implementation
- [ ] Blink pattern implementation
- [ ] Solid pattern implementation
- [ ] Pattern transitions
- [ ] Speed control

**Kryteria uko≈Ñczenia:**
- [ ] Wszystkie wzory animacji dzia≈ÇajƒÖ
- [ ] Transitions miƒôdzy wzorami dzia≈ÇajƒÖ
- [ ] Speed control dzia≈Ça
- [ ] Testy jednostkowe dla patterns

#### **Task 2.3: Implementacja Button Handler** üî• WYSOKI PRIORYTET
**Cel:** Symulacja przycisku fizycznego w emulatorze

**Szczeg√≥≈Çy implementacji:**
- [ ] Utworzenie `src/main/buttonHandler.ts`
- [ ] Single press (Ask to Enter)
- [ ] Long press (Reset/Pairing mode)
- [ ] Double press (Toggle brightness)
- [ ] Visual feedback
- [ ] Debouncing

**Kryteria uko≈Ñczenia:**
- [ ] Wszystkie typy przycisk√≥w dzia≈ÇajƒÖ
- [ ] Visual feedback dzia≈Ça
- [ ] Debouncing dzia≈Ça
- [ ] Testy jednostkowe dla button handler

#### **Task 2.4: Integracja LED z Button** üìã ≈öREDNI PRIORYTET
**Cel:** Integracja LED Controller z Button Handler

**Szczeg√≥≈Çy implementacji:**
- [ ] LED feedback dla przycisk√≥w
- [ ] Brightness control przez przyciski
- [ ] Pattern changes przez przyciski
- [ ] Visual indicators

**Kryteria uko≈Ñczenia:**
- [ ] LED feedback dzia≈Ça dla wszystkich przycisk√≥w
- [ ] Brightness control dzia≈Ça
- [ ] Pattern changes dzia≈ÇajƒÖ
- [ ] Testy integracyjne

#### **Task 2.5: Testy jednostkowe dla LED system** üìã ≈öREDNI PRIORYTET
**Cel:** Pokrycie testami systemu LED

**Szczeg√≥≈Çy implementacji:**
- [ ] Testy dla LED Controller
- [ ] Testy dla LED Patterns
- [ ] Testy dla Button Handler
- [ ] Testy integracyjne LED + Button

**Kryteria uko≈Ñczenia:**
- [ ] Pokrycie testami >90%
- [ ] Wszystkie testy przechodzƒÖ
- [ ] Testy dla edge cases

---

## Sprint 3: Budowanie Emulatora - WiFi Communication

**Cel Sprintu:** Implementacja komunikacji WiFi i WebSocket server w emulatorze.

### Epik: WiFi Communication & WebSocket Server

#### **Task 3.1: Implementacja WebSocket Server** üî• WYSOKI PRIORYTET
**Cel:** Serwer WebSocket do komunikacji z tray app

**Szczeg√≥≈Çy implementacji:**
- [ ] Utworzenie `src/main/wifiManager.ts`
- [ ] Implementacja WebSocket server
- [ ] Obs≈Çuga po≈ÇƒÖcze≈Ñ klient√≥w
- [ ] Message routing
- [ ] Error handling

**Kryteria uko≈Ñczenia:**
- [ ] WebSocket server uruchamia siƒô na porcie 8080
- [ ] Obs≈Çuguje po≈ÇƒÖczenia z tray app
- [ ] Loguje po≈ÇƒÖczenia i b≈Çƒôdy
- [ ] Testy jednostkowe dla WebSocket

#### **Task 3.2: Implementacja Message Handlers** üî• WYSOKI PRIORYTET
**Cel:** Obs≈Çuga wiadomo≈õci WebSocket w emulatorze

**Szczeg√≥≈Çy implementacji:**
- [ ] StatusUpdate handler
- [ ] AskToEnterRequest handler
- [ ] AskToEnterResponse handler
- [ ] BatteryReport handler
- [ ] Message validation

**Kryteria uko≈Ñczenia:**
- [ ] Wszystkie typy wiadomo≈õci sƒÖ obs≈Çugiwane
- [ ] Walidacja wiadomo≈õci dzia≈Ça
- [ ] Error handling dla nieprawid≈Çowych wiadomo≈õci
- [ ] Testy jednostkowe dla message handlers

#### **Task 3.3: Integracja LED z WebSocket** üî• WYSOKI PRIORYTET
**Cel:** Aktualizacja LED na podstawie wiadomo≈õci WebSocket

**Szczeg√≥≈Çy implementacji:**
- [ ] Integracja LED Controller z WebSocket
- [ ] Automatyczna aktualizacja LED przy status update
- [ ] Visual feedback dla ask to enter
- [ ] Battery level indication

**Kryteria uko≈Ñczenia:**
- [ ] LED zmienia kolor przy status update
- [ ] Visual feedback dla ask to enter dzia≈Ça
- [ ] Battery level jest wy≈õwietlany
- [ ] Testy integracyjne

#### **Task 3.4: Implementacja Battery Simulation** üìã ≈öREDNI PRIORYTET
**Cel:** Symulacja poziomu baterii w emulatorze

**Szczeg√≥≈Çy implementacji:**
- [ ] Symulacja poziomu baterii (0-100%)
- [ ] Automatyczne zmniejszanie poziomu
- [ ] Raportowanie co 5 minut
- [ ] Charging state simulation

**Kryteria uko≈Ñczenia:**
- [ ] Battery level jest symulowany
- [ ] Raporty sƒÖ wysy≈Çane co 5 minut
- [ ] Charging state dzia≈Ça
- [ ] Testy jednostkowe dla battery simulation

#### **Task 3.5: Testy integracyjne WebSocket** üìã ≈öREDNI PRIORYTET
**Cel:** Testy komunikacji WebSocket w emulatorze

**Szczeg√≥≈Çy implementacji:**
- [ ] Testy po≈ÇƒÖczenia WebSocket
- [ ] Testy wysy≈Çania wiadomo≈õci
- [ ] Testy odbierania wiadomo≈õci
- [ ] Testy error handling

**Kryteria uko≈Ñczenia:**
- [ ] Wszystkie testy integracyjne przechodzƒÖ
- [ ] Testy dla r√≥≈ºnych scenariuszy b≈Çƒôd√≥w
- [ ] Performance tests

---

## Sprint 4: Integracja z Tray App

**Cel Sprintu:** Integracja emulatora z testami E2E w tray-app.

### Epik: E2E Integration & Testing

#### **Task 4.1: Implementacja Test Mode** üî• WYSOKI PRIORYTET
**Cel:** Tryb testowy dla emulatora

**Szczeg√≥≈Çy implementacji:**
- [ ] Test mode flag
- [ ] Test controller API
- [ ] Simplified communication
- [ ] Test scenarios
- [ ] Mock reset functionality

**Kryteria uko≈Ñczenia:**
- [ ] Test mode dzia≈Ça
- [ ] API do kontrolowania emulatora dzia≈Ça
- [ ] Mock reset dzia≈Ça
- [ ] Testy dla test mode

#### **Task 4.2: Mock Controller API** üî• WYSOKI PRIORYTET
**Cel:** API do kontrolowania emulatora w testach

**Szczeg√≥≈Çy implementacji:**
- [ ] pressButton() method
- [ ] receiveSerialData() method
- [ ] sendAskToEnterRequest() method
- [ ] getLEDStatus() method
- [ ] getLastResponse() method

**Kryteria uko≈Ñczenia:**
- [ ] Wszystkie metody API dzia≈ÇajƒÖ
- [ ] API jest dobrze udokumentowane
- [ ] Testy jednostkowe dla API
- [ ] JSDoc dla wszystkich metod

#### **Task 4.3: Integracja z Playwright** üî• WYSOKI PRIORYTET
**Cel:** Integracja z testami Playwright w tray-app

**Szczeg√≥≈Çy implementacji:**
- [ ] Mock helper dla Playwright
- [ ] Setup/teardown functions
- [ ] Device action simulation
- [ ] Response verification
- [ ] Error handling

**Kryteria uko≈Ñczenia:**
- [ ] Mock helper dzia≈Ça z Playwright
- [ ] Setup/teardown dzia≈Ça
- [ ] Device actions sƒÖ symulowane
- [ ] Testy integracyjne z Playwright

#### **Task 4.4: Test Parowania (Task 4.15)** üìã ≈öREDNI PRIORYTET
**Cel:** Test E2E dla procesu parowania z emulatorem

**Szczeg√≥≈Çy implementacji:**
- [ ] Test complete pairing flow
- [ ] Mock device simulation
- [ ] Tray app interaction
- [ ] Verification steps
- [ ] Error scenarios

**Kryteria uko≈Ñczenia:**
- [ ] Test parowania przechodzi
- [ ] Mock symuluje urzƒÖdzenie
- [ ] Tray app interaction dzia≈Ça
- [ ] Verification dzia≈Ça
- [ ] Error scenarios sƒÖ testowane

#### **Task 4.5: Test Ask to Enter (Task 6.7)** üìã ≈öREDNI PRIORYTET
**Cel:** Test E2E dla "Ask to Enter" z emulatorem

**Szczeg√≥≈Çy implementacji:**
- [ ] Test ask to enter flow
- [ ] Notification verification
- [ ] Response handling
- [ ] Different urgency levels
- [ ] Error scenarios

**Kryteria uko≈Ñczenia:**
- [ ] Test ask to enter przechodzi
- [ ] Notifications sƒÖ weryfikowane
- [ ] Response handling dzia≈Ça
- [ ] Different urgency levels sƒÖ testowane
- [ ] Error scenarios sƒÖ testowane

---

## Sprint 5: Zaawansowane Funkcje i Optymalizacja

**Cel Sprintu:** Zaawansowane funkcje, optymalizacja i dokumentacja emulatora.

### Epik: Advanced Features & Optimization

#### **Task 5.1: Multiple Device Support** üî• WYSOKI PRIORYTET
**Cel:** Obs≈Çuga wielu urzƒÖdze≈Ñ w emulatorze

**Szczeg√≥≈Çy implementacji:**
- [ ] Multiple device instances
- [ ] Device identification
- [ ] Independent state management
- [ ] Device-specific configurations
- [ ] Load balancing

**Kryteria uko≈Ñczenia:**
- [ ] Multiple devices sƒÖ obs≈Çugiwane
- [ ] Device identification dzia≈Ça
- [ ] Independent state management dzia≈Ça
- [ ] Testy dla multiple devices

#### **Task 5.2: Performance Optimization** üî• WYSOKI PRIORYTET
**Cel:** Optymalizacja wydajno≈õci emulatora

**Szczeg√≥≈Çy implementacji:**
- [ ] Memory usage optimization
- [ ] CPU usage optimization
- [ ] Network latency reduction
- [ ] Efficient message handling
- [ ] Resource cleanup

**Kryteria uko≈Ñczenia:**
- [ ] Memory usage jest zoptymalizowane
- [ ] CPU usage jest zoptymalizowane
- [ ] Network latency jest zredukowane
- [ ] Performance tests przechodzƒÖ

#### **Task 5.3: Error Handling & Recovery** üìã ≈öREDNI PRIORYTET
**Cel:** Zaawansowane error handling w emulatorze

**Szczeg√≥≈Çy implementacji:**
- [ ] Network error recovery
- [ ] Serial communication errors
- [ ] Device state recovery
- [ ] Automatic retry mechanisms
- [ ] Error logging

**Kryteria uko≈Ñczenia:**
- [ ] Error recovery dzia≈Ça
- [ ] Automatic retry dzia≈Ça
- [ ] Error logging dzia≈Ça
- [ ] Testy dla error scenarios

#### **Task 5.4: CI/CD Integration** üìã ≈öREDNI PRIORYTET
**Cel:** Integracja z CI/CD dla emulatora

**Szczeg√≥≈Çy implementacji:**
- [ ] GitHub Actions workflow
- [ ] Automated testing
- [ ] Build automation
- [ ] Deployment scripts
- [ ] Environment configuration

**Kryteria uko≈Ñczenia:**
- [ ] CI/CD pipeline dzia≈Ça
- [ ] Automated testing dzia≈Ça
- [ ] Build automation dzia≈Ça
- [ ] Deployment scripts dzia≈ÇajƒÖ

#### **Task 5.5: Documentation & Examples** üìã ≈öREDNI PRIORYTET
**Cel:** Kompletna dokumentacja emulatora

**Szczeg√≥≈Çy implementacji:**
- [ ] API documentation
- [ ] Usage examples
- [ ] Integration guide
- [ ] Troubleshooting guide
- [ ] Video tutorials

**Kryteria uko≈Ñczenia:**
- [ ] API documentation jest kompletna
- [ ] Usage examples dzia≈ÇajƒÖ
- [ ] Integration guide jest jasny
- [ ] Troubleshooting guide jest pomocny

---

## Sprint 6: Emulator UI & Error Simulation

**Cel Sprintu:** Wdro≈ºenie ulepsze≈Ñ zdefiniowanych w `07.enhancements.md`, aby podnie≈õƒá warto≈õƒá emulatora jako narzƒôdzia deweloperskiego.

### Epik: Developer Experience Enhancements

#### **Task 6.1: Implementacja wizualizacji UI** üî• WYSOKI PRIORYTET
**Cel:** Stworzenie prostego interfejsu webowego dla emulatora.
- [ ] Zintegrowanie serwera HTTP do serwowania `index.html`.
- [ ] Stworzenie pliku `public/index.html` z wizualizacjƒÖ LED ring i przyciskiem.
- [ ] Implementacja logiki WebSocket po stronie klienta (JS) do aktualizacji UI.

#### **Task 6.2: Implementacja API do symulacji b≈Çƒôd√≥w** üî• WYSOKI PRIORYTET
**Cel:** Rozszerzenie `TestController` o metody do symulacji awarii.
- [ ] Implementacja `simulateDisconnect()`.
- [ ] Implementacja `simulatePairingError()`.
- [ ] Implementacja `simulateBatteryDrop()`.
- [ ] Implementacja `simulateTimeout()`.
- [ ] Dodanie test√≥w jednostkowych dla nowych metod kontrolera.

---

## Sprint 7: Refinement & Documentation

**Cel Sprintu:** Finalne szlify, optymalizacja i uzupe≈Çnienie dokumentacji.

### Epik: Final Polish

#### **Task 7.1: Refaktoryzacja i przeglƒÖd kodu**
#### **Task 7.2: Uzupe≈Çnienie dokumentacji JSDoc i README**

---

## üìä Metryki Sukcesu

### Technical Metrics
- **Test Coverage**: >90% dla core functionality
- **Performance**: <100ms response time dla status updates
- **Reliability**: 99.9% uptime podczas testing sessions
- **Compatibility**: Works z current tray app bez modyfikacji

### Development Metrics
- **Code Quality**: ESLint score >95%
- **Documentation**: JSDoc coverage dla wszystkich public APIs
- **Maintainability**: Clear separation of concerns, modular design

---

## üöÄ Definition of Done

### Dla ka≈ºdego taska:
- [ ] Kod jest napisany i dzia≈Ça
- [ ] Testy jednostkowe przechodzƒÖ
- [ ] Testy integracyjne przechodzƒÖ (je≈õli applicable)
- [ ] Code review jest zako≈Ñczony
- [ ] Dokumentacja jest zaktualizowana
- [ ] JSDoc jest dodany dla public APIs

### Dla ka≈ºdego sprintu:
- [ ] Wszystkie taski sƒÖ uko≈Ñczone
- [ ] Sprint review jest przeprowadzony
- [ ] Retrospective jest przeprowadzony
- [ ] Nastƒôpny sprint jest zaplanowany

---

## üìù Uwagi dla Programist√≥w

### Wa≈ºne Uwagi
1. **Test Mode** - Emulator ma specjalny tryb dla test√≥w E2E
2. **Port Configuration** - Emulator u≈ºywa portu 8080 dla WebSocket
3. **Error Handling** - Wszystkie b≈Çƒôdy muszƒÖ byƒá obs≈Çugiwane
4. **Documentation** - Ka≈ºda funkcja musi mieƒá JSDoc

### Debugging
```typescript
// W≈ÇƒÖcz debug mode
const mockDevice = new DeviceMock({
  debug: true,
  testMode: true
});

// Sprawd≈∫ logi
mockDevice.onLog((message: string) => {
  console.log(`[Mock] ${message}`);
});
```

---

**Note**: Ten plan zapewnia systematyczne wdro≈ºenie emulatora urzƒÖdzenia z mo≈ºliwo≈õciƒÖ ≈õledzenia postƒôpu i uko≈Ñczenia wszystkich wymaganych funkcjonalno≈õci.
